<!-- Author: Yannik M. -->

<html>
  <head>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="groups.js"></script>
    <script>
      
      //saves the currently displayed group. Null if no Popup visible.
      var currentGroup = null;
      
      
      function filter_list(){
        var list = document.getElementById("search_list");
        var arr = this.global_groups.sort(compareGroups);
        var name = document.getElementById("input_field").value;
        name = name.toLowerCase();
        
        //reset list
        list.innerHTML = "";
        
        
        //split into tokens
        var tokens = name.split();
        console.log(tokens);
        
        
        for (var i = 0; i < arr.length; i++){
          
          //check if all tokens fit
          var fitting = true;
          for(var t = 0; t < tokens.length; t++){
            if (!arr[i].name.toLowerCase().includes(tokens[t]) 
                  && !arr[i].description.toLowerCase().includes(tokens[t])){
               fitting = false;
            }
          }
          
          //add to list
          if(fitting){
            var item = document.createElement('li');
            item.innerHTML = arr[i].name;
            item.id = arr[i].name;
            item.onclick = function() {onGroupClicked(this.id);};
            list.appendChild(item);
          }
          
        }
        
        if( list.innerHTML == ''){
          list.appendChild(document.createTextNode('Keine Suchergebnisse gefunden'));
        }
      }
      
      
      
      
      function onGroupClicked(name){
        
        var group = findGroupByName(name)
        // console.log(group);
        currentGroup = group;
        if(group == null) return;
        
        
        //display clicked group in modal
        var title = document.getElementById("modal_title");
        title.innerHTML = "Gruppe: " + group.name;
        
        var desc = document.getElementById("modal_desc");
        desc.innerHTML = group.description;
        
        var member = document.getElementById("modal_member");
        member.innerHTML = "Mitglieder (" + group.members.length + "/" + group.max + ")";
        
        var list = document.getElementById("modal_list");
        list.innerHTML = "";
        for(var i = 0; i < group.members.length; i++){
          var item = document.createElement('li');
          item.innerHTML = group.members[i];
          item.style = "text-align: start;"
          list.appendChild(item);
        }
        
        //show modal
        var modal = document.getElementById("modal");
        modal.style.display = "block";
      }
      
      
      
      function showAlert(text) {
        alert(text);
      }
      
      
      
      function sendJoinRequest(){
        
        //show alert
        var text = "Beitrittsanfrage erfolgreich versendet: \n" + currentGroup.name;
        showAlert(text);
        
        //close popup
        closeModal();
      }
      
      
      function closeModal(){
        var modal = document.getElementById("modal");
        modal.style.display = "none";
        currentGroup = null;
      }
      
      
      
      window.onload = function(){
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
          var modal = document.getElementById("modal");
          if (event.target == modal) {
            closeModal();
          }
        }
      }
      
      
      
      
    </script>
    
  </head>
  
  <body>
    
    
    
    
    <div class="flex-container">
      
      <div class="menu desktop-8-cols phone-12-cols">
      
        <label style="position:relative; left: 40%;"><h1>Suche eine Gruppe: </h1></label>
        
        <div>
          <input style="position:relative; left: 40%; width: 35%" type="text" placeholder="Suchbegriff eingeben" id ="input_field">
          <button onClick="filter_list()" style="position:relative; left:45%">Suche</button>
        </div>
        
    
        <ul style="position:relative; left:25%" id="search_list">
       
      </div>
      
    </div>
    
    
    
    
    <!-- Modal -->
    <div id="modal" class="modal">
      
      <div class="modal-content">
        <span onclick="closeModal()" id="modalCloseButton" class="close">&times;</span>
        <h2 id="modal_title"></h2>
        <p id="modal_desc"></p>
        <h4 id="modal_member"><h4>
        <ul id="modal_list">
          <li style="text-align: start;"></li>
        </ul>
        <button onclick="sendJoinRequest()">Beitrittsanfrage senden</button>
      </div>
    </div>
    
    
  </body>
</html>